<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Escaleta Hub - Firebase</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* ===== VARIÁVEIS DE CORES ===== */
:root {
  --primary: #2a5a78;
  --secondary: #9c6ade;
  --accent: #41b883;
  --bg: #f8fbff;
  --text: #2c3e50;
  --danger: #ff6b6b;
}
/* ===== RESET E ESTILOS ===== */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', sans-serif; }
body { background: var(--bg); color: var(--text); }
/* ===== LOGIN ===== */
.login-screen { display:flex; justify-content:center; align-items:center; height:100vh; background: linear-gradient(135deg, var(--primary), #1a3650); }
.login-box { background:white; padding:2rem; border-radius:10px; width:90%; max-width:400px; box-shadow:0 10px 30px rgba(0,0,0,0.2);}
.login-box input { width:100%; padding:10px; margin-bottom:1rem; border-radius:5px; border:1px solid #ddd;}
.login-btn { width:100%; padding:12px; background: var(--secondary); color:white; border:none; border-radius:5px; cursor:pointer;}
.error-message { color: var(--danger); text-align:center; margin-bottom:10px; display:none; }
/* ===== PLATAFORMA ===== */
.platform { display:none; flex-direction:column; height:100vh; }
header { background: var(--primary); color:white; padding:1rem; display:flex; justify-content:space-between; align-items:center; }
.main-container { display:flex; flex:1; overflow:hidden; }
.sidebar { width:250px; background:#3a4f66; padding:1rem; color:#e0f0ff; }
.sidebar button { display:block; width:100%; margin-bottom:0.5rem; background:none; border:none; color:#e0f0ff; padding:0.5rem; cursor:pointer; border-radius:5px;}
.sidebar button.active { background: var(--secondary); }
.workspace { flex:1; display:flex; flex-direction:column; padding:1rem; overflow:auto; }
#scriptEditor { background:white; padding:1rem; min-height:300px; overflow:auto; font-family: 'Courier New', monospace;}
.chat-container { margin-top:1rem; background:white; padding:1rem; border-radius:5px; height:300px; display:flex; flex-direction:column;}
.chat-messages { flex:1; overflow:auto; margin-bottom:1rem; }
.chat-input { display:flex; gap:0.5rem; }
.chat-input input { flex:1; padding:8px; border-radius:5px; border:1px solid #ddd;}
.chat-input button { padding:8px 12px; border:none; border-radius:5px; background: var(--accent); color:white; cursor:pointer;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen" class="login-screen">
  <div class="login-box">
    <h2>Entrar no Escaleta Hub</h2>
    <div id="errorMessage" class="error-message"></div>
    <input type="email" id="email" placeholder="E-mail">
    <input type="password" id="password" placeholder="Senha">
    <button id="loginBtn" class="login-btn">Entrar</button>
  </div>
</div>

<!-- PLATAFORMA -->
<div id="platform" class="platform">
  <header>
    <div>Escaleta Hub - <span id="userName"></span></div>
    <button id="logoutBtn">Sair</button>
  </header>
  <div class="main-container">
    <nav class="sidebar">
      <button class="sidebar-btn active" data-tab="editor">Editor de Roteiro</button>
      <button class="sidebar-btn" data-tab="chat">Chat</button>
    </nav>
    <main class="workspace">
      <div id="editor" class="tab-content active">
        <div id="scriptEditor" contenteditable="true"></div>
        <button id="saveBtn">Salvar</button>
      </div>
      <div id="chat" class="tab-content">
        <div class="chat-container">
          <div id="chatMessages" class="chat-messages"></div>
          <div class="chat-input">
            <input type="text" id="chatInput" placeholder="Digite sua mensagem">
            <button id="sendMessageBtn">Enviar</button>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- FIREBASE -->
<script type="module">
  // Import Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, onSnapshot, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCsi6yy41s8DgT88lPRtlLKQFFYrgAgMSo",
    authDomain: "escaleta-hub.firebaseapp.com",
    projectId: "escaleta-hub",
    storageBucket: "escaleta-hub.appspot.com",
    messagingSenderId: "825021624145",
    appId: "1:825021624145:web:1f43b9574d041d8e206d70",
    measurementId: "G-NC9QFD3063"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const loginScreen = document.getElementById('loginScreen');
  const platform = document.getElementById('platform');
  const userNameSpan = document.getElementById('userName');
  const errorDiv = document.getElementById('errorMessage');

  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logoutBtn');

  const scriptEditor = document.getElementById('scriptEditor');
  const saveBtn = document.getElementById('saveBtn');

  const chatMessages = document.getElementById('chatMessages');
  const chatInput = document.getElementById('chatInput');
  const sendMessageBtn = document.getElementById('sendMessageBtn');

  let currentUser = null;
  const roteiroRef = doc(db, "projetos", "projeto1");
  const chatRef = doc(db, "chats", "projeto1");

  // LOGIN
  loginBtn.addEventListener('click', async () => {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    if (!email || !password) { showError("Preencha e-mail e senha!"); return; }
    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      currentUser = userCredential.user;
      userNameSpan.textContent = currentUser.email.split('@')[0];
      loginScreen.style.display = 'none';
      platform.style.display = 'flex';
      listenRoteiro();
      listenChat();
    } catch (e) { showError(e.message); }
  });

  logoutBtn.addEventListener('click', async () => {
    await signOut(auth);
    platform.style.display = 'none';
    loginScreen.style.display = 'flex';
    currentUser = null;
  });

  // FUNÇÕES
  function showError(msg) { errorDiv.textContent = msg; errorDiv.style.display='block'; setTimeout(()=>errorDiv.style.display='none',5000);}
  
  // SALVAR ROTEIRO
  saveBtn.addEventListener('click', async () => {
    await setDoc(roteiroRef, { conteudo: scriptEditor.innerHTML });
    alert("Roteiro salvo!");
  });

  // ESCUTAR ROTEIRO EM TEMPO REAL
  function listenRoteiro() {
    onSnapshot(roteiroRef, (docSnap) => {
      if(docSnap.exists()){
        scriptEditor.innerHTML = docSnap.data().conteudo || "";
      }
    });
  }

  // CHAT
  sendMessageBtn.addEventListener('click', enviarMensagem);
  chatInput.addEventListener('keypress', (e) => { if(e.key==='Enter') enviarMensagem(); });

  async function enviarMensagem() {
    const text = chatInput.value.trim();
    if(!text) return;
    const msg = { sender: currentUser.email.split('@')[0], text };
    await updateDoc(chatRef, { messages: arrayUnion(msg) }).catch(async ()=>{
      await setDoc(chatRef, { messages: [msg] });
    });
    chatInput.value = '';
  }

  function listenChat() {
    onSnapshot(chatRef, (docSnap)=>{
      if(docSnap.exists()){
        chatMessages.innerHTML = '';
        const msgs = docSnap.data().messages || [];
        msgs.forEach(m=>{
          const div = document.createElement('div');
          div.innerHTML = `<strong>${m.sender}:</strong> ${m.text}`;
          chatMessages.appendChild(div);
        });
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
    });
  }

  // ABAS
  const sidebarBtns = document.querySelectorAll('.sidebar-btn');
  sidebarBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
      document.querySelectorAll('.sidebar-btn').forEach(b=>b.classList.remove('active'));
      document.getElementById(btn.dataset.tab).classList.add('active');
      btn.classList.add('active');
    });
  });

</script>
</body>
</html>



