<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Escaleta Hub</title>
<link rel="stylesheet" href="style.css">
<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

<header>
  <h1 class="logo">Escaleta Hub</h1>
  <nav>
    <button class="tab-btn active" data-tab="inicio">Início</button>
    <button class="tab-btn" data-tab="aulas">Aulas</button>
    <button class="tab-btn" data-tab="recursos">Recursos</button>
    <button class="tab-btn" data-tab="storyboard">Storyboard</button>
    <button class="tab-btn" data-tab="comunidade">Comunidade</button>
  </nav>
  <div id="userPanel">
    <span id="userName" style="color:#ffdd40; margin-right:10px;"></span>
    <button id="logoutBtn" class="btn" style="display:none;">Logout</button>
  </div>
</header>

<main>
  <div id="inicio" class="tab active">
    <h2>Bem-vindo ao Escaleta Hub</h2>
    <p>Seu centro para recursos musicais e aulas de escaleta!</p>
  </div>

  <div id="aulas" class="tab">
    <h2>Aulas</h2>
    <p>Aprenda a tocar escaleta do iniciante ao avançado.</p>
  </div>

  <div id="recursos" class="tab">
    <h2>Recursos</h2>
    <p>Baixe partituras, tablaturas e materiais exclusivos.</p>
  </div>

  <div id="storyboard" class="tab">
    <h2>Storyboard</h2>
    <div class="canvas-container">
      <canvas id="storyboardCanvas" width="800" height="400"></canvas>
      <div class="editor-controls">
        <input type="color" id="drawingColor" value="#ffdd40">
        <input type="range" id="brushSize" min="1" max="20" value="4">
        <button class="btn" id="clearCanvas">Limpar</button>
        <button class="btn" id="saveCanvas">Salvar Imagem</button>
      </div>
    </div>
  </div>

  <div id="comunidade" class="tab">
    <h2>Chat Fofoca</h2>
    <div id="authSection">
      <input type="email" id="email" placeholder="E-mail">
      <input type="password" id="password" placeholder="Senha">
      <button id="loginBtn" class="btn btn-primary">Login</button>
      <button id="signupBtn" class="btn">Criar Conta</button>
    </div>
    <div id="fofoca" style="display:none;">
      <div id="fofoca-header">Fofoca <span id="toggleChat">⬆️</span></div>
      <div id="fofoca-body">
        <div id="messages" style="flex:1; overflow-y:auto;"></div>
        <textarea id="chatInput" placeholder="Escreva sua mensagem..."></textarea>
        <button id="sendMsg" class="btn btn-primary">Enviar</button>
      </div>
    </div>
  </div>
</main>

<script>
  // ================== FIREBASE CONFIG ==================
  const firebaseConfig = {
    apiKey: "SEU_API_KEY",
    authDomain: "SEU_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://SEU_PROJECT_ID-default-rtdb.firebaseio.com",
    projectId: "SEU_PROJECT_ID",
    storageBucket: "SEU_PROJECT_ID.appspot.com",
    messagingSenderId: "SEU_SENDER_ID",
    appId: "SEU_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  // ================== ABAS ==================
  const tabs = document.querySelectorAll(".tab-btn");
  const contents = document.querySelectorAll(".tab");
  tabs.forEach(btn => {
    btn.addEventListener("click", () => {
      tabs.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      const target = btn.dataset.tab;
      contents.forEach(c => c.classList.remove("active"));
      document.getElementById(target).classList.add("active");
    });
  });

  // ================== CANVAS ==================
  const canvas = document.getElementById("storyboardCanvas");
  const ctx = canvas.getContext("2d");
  let painting = false;
  canvas.addEventListener("mousedown", () => painting=true);
  canvas.addEventListener("mouseup", () => {painting=false; ctx.beginPath();});
  canvas.addEventListener("mousemove", draw);

  function draw(e){
    if(!painting) return;
    ctx.lineWidth = document.getElementById("brushSize").value;
    ctx.lineCap = "round";
    ctx.strokeStyle = document.getElementById("drawingColor").value;
    const rect = canvas.getBoundingClientRect();
    ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
  }

  document.getElementById("clearCanvas").onclick = () => ctx.clearRect(0,0,canvas.width,canvas.height);
  document.getElementById("saveCanvas").onclick = () => {
    const link = document.createElement("a");
    link.download = "storyboard.png";
    link.href = canvas.toDataURL();
    link.click();
  }

  // ================== AUTH ==================
  const loginBtn = document.getElementById("loginBtn");
  const signupBtn = document.getElementById("signupBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const userName = document.getElementById("userName");
  const authSection = document.getElementById("authSection");
  const fofocaDiv = document.getElementById("fofoca");

  loginBtn.addEventListener("click", () => {
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, pass)
    .catch(err => alert(err.message));
  });

  signupBtn.addEventListener("click", () => {
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;
    auth.createUserWithEmailAndPassword(email, pass)
    .catch(err => alert(err.message));
  });

  logoutBtn.addEventListener("click", () => auth.signOut());

  auth.onAuthStateChanged(user => {
    if(user){
      userName.textContent = user.email;
      logoutBtn.style.display = "inline-block";
      authSection.style.display = "none";
      fofocaDiv.style.display = "flex";
    } else {
      userName.textContent = "";
      logoutBtn.style.display = "none";
      authSection.style.display = "block";
      fofocaDiv.style.display = "none";
    }
  });

  // ================== CHAT ==================
  const chatBody = document.getElementById("fofoca-body");
  const toggleChat = document.getElementById("toggleChat");
  toggleChat.addEventListener("click", ()=> {
    chatBody.style.display = chatBody.style.display === "flex" ? "none" : "flex";
  });

  const messagesDiv = document.getElementById("messages");
  const chatInput = document.getElementById("chatInput");
  const sendBtn = document.getElementById("sendMsg");

  sendBtn.addEventListener("click", sendMessage);
  chatInput.addEventListener("keypress", e => { if(e.key==="Enter"){ e.preventDefault(); sendMessage(); }});

  function sendMessage(){
    const msg = chatInput.value.trim();
    const user = auth.currentUser;
    if(!msg || !user) return;
    db.ref("chat").push({message: msg, user: user.email, time: Date.now()});
    chatInput.value="";
  }

  db.ref("chat").on("child_added", snapshot => {
    const data = snapshot.val();
    const div = document.createElement("div");
    div.textContent = `${data.user}: ${data.message}`;
    div.style.marginBottom = "6px";
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });
</script>
</body>
</html>
