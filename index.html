<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plataforma de Roteiro</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    body { margin:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; height:100vh; display:flex; flex-direction:column;}
    .top-tabs { display:flex; background:#2c3e50; font-weight:bold;}
    .tab-btn { flex:1; padding:1rem; color:white; border:none; cursor:pointer; font-size:1rem;}
    .tab-btn.active { background:#e74c3c;}
    .tab-content { display:none; flex:1; overflow:auto; height:calc(100vh - 50px);}
    .tab-content.active { display:block;}
    .script-editor, .rascunho-editor { padding:20px; height:100%; overflow-y:auto; font-family:'Courier New', monospace; font-size:12pt;}
    .scene-heading { font-weight:bold; text-transform:uppercase; margin-top:1.5rem; color:#3498db; cursor:pointer;}
    .action { margin:0.8rem 0; padding:5px; border-radius:3px; cursor:pointer;}
    .character { text-align:center; width:50%; margin:0.8rem auto; font-weight:bold; padding:5px; border-radius:3px; cursor:pointer;}
    .dialogue { width:60%; margin:0 auto; padding:5px; border-radius:3px; cursor:pointer;}
    .parenthetical { width:50%; margin:0 auto; padding-left:2rem; padding:5px; border-radius:3px; cursor:pointer;}
    .transition { text-align:right; margin-top:1rem; text-transform:uppercase; font-weight:bold; padding:5px; border-radius:3px; cursor:pointer;}
    #stats-panel { padding:10px; background:#f0f0f0; }
    #storyboard-canvas { border:1px solid #ccc; display:block; margin:20px auto; }
    #add-frame { display:block; margin:10px auto; padding:8px 12px; font-size:1rem; cursor:pointer;}
</style>
</head>
<body>

<!-- MENU SUPERIOR COM ABAS -->
<div class="top-tabs">
    <button class="tab-btn active" data-tab="roteiro-tab">Roteiro</button>
    <button class="tab-btn" data-tab="escaleta-tab">Escaleta</button>
    <button class="tab-btn" data-tab="tratamento-tab">Tratamento</button>
    <button class="tab-btn" data-tab="biblia-tab">Bíblia</button>
    <button class="tab-btn" data-tab="sala-tab">Sala de Roteiro</button>
    <button class="tab-btn" data-tab="storyboard-tab">Storyboard</button>
    <button class="tab-btn" data-tab="rascunho-tab">Rascunho</button>
</div>

<!-- ABAS -->
<div class="tab-content active" id="roteiro-tab">
    <div class="script-editor" contenteditable="true"></div>
    <div id="stats-panel"></div>
</div>
<div class="tab-content" id="escaleta-tab">
    <div contenteditable="true" style="padding:20px;">Conteúdo Escaleta...</div>
</div>
<div class="tab-content" id="tratamento-tab">
    <div contenteditable="true" style="padding:20px;">Conteúdo Tratamento...</div>
</div>
<div class="tab-content" id="biblia-tab">
    <div contenteditable="true" style="padding:20px;">Conteúdo Bíblia...</div>
</div>
<div class="tab-content" id="sala-tab">
    <div contenteditable="true" style="padding:20px;">Conteúdo Sala de Roteiro...</div>
</div>
<div class="tab-content" id="storyboard-tab">
    <canvas id="storyboard-canvas" width="900" height="400"></canvas>
    <button id="add-frame">+ Adicionar Quadro</button>
</div>
<div class="tab-content" id="rascunho-tab">
    <div class="rascunho-editor" contenteditable="true"></div>
</div>

<script>
/* --- ABAS --- */
document.querySelectorAll('.tab-btn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.getAttribute('data-tab')).classList.add('active');
    });
});

/* --- INSERÇÃO DE HTML NO ROTEIRO --- */
function insertAtCursor(editor, html){
    const sel = window.getSelection();
    if(!sel.rangeCount) return;
    const range = sel.getRangeAt(0);
    const frag = document.createRange().createContextualFragment(html);
    range.insertNode(frag);
    range.collapse(false);
    editor.focus();
}

/* --- ATALHOS DE ROTEIRO --- */
document.addEventListener('keydown', function(e) {
    const editor = document.querySelector('#roteiro-tab .script-editor');
    if(!editor.contains(document.activeElement)) return;
    if(e.ctrlKey && e.key==='1'){ e.preventDefault(); insertAtCursor(editor, '<div class="scene-heading">NOVA CENA</div>'); }
    if(e.ctrlKey && e.key==='2'){ e.preventDefault(); insertAtCursor(editor, '<div class="action">AÇÃO...</div>'); }
    if(e.ctrlKey && e.key==='3'){ e.preventDefault(); insertAtCursor(editor, '<div class="character">PERSONAGEM</div>'); }
    if(e.ctrlKey && e.key==='4'){ e.preventDefault(); insertAtCursor(editor, '<div class="dialogue">DIÁLOGO...</div>'); }
    if(e.ctrlKey && e.key==='b'){ document.execCommand('bold'); e.preventDefault(); }
    if(e.ctrlKey && e.key==='i'){ document.execCommand('italic'); e.preventDefault(); }
    if(e.ctrlKey && e.key==='u'){ document.execCommand('underline'); e.preventDefault(); }
});

/* --- SALVAMENTO SIMULADO --- */
setInterval(()=>{ console.log('Salvando...'); },30000);

/* --- ANOTAÇÕES INLINE --- */
document.querySelectorAll('#roteiro-tab .script-editor').forEach(editor=>{
    editor.addEventListener('dblclick', e=>{
        const note = prompt('Digite sua nota para esta parte do roteiro:');
        if(note){
            const span = document.createElement('span');
            span.textContent = note;
            span.style.background='yellow';
            span.style.cursor='help';
            span.title='Nota: '+note;
            e.target.appendChild(span);
        }
    });
});

/* --- ESTATÍSTICAS --- */
function atualizarEstatisticas(){
    const editor = document.querySelector('#roteiro-tab .script-editor');
    if(!editor) return;
    const cenas = editor.querySelectorAll('.scene-heading').length;
    const personagens = editor.querySelectorAll('.character').length;
    const dialogos = editor.querySelectorAll('.dialogue').length;
    const statsPanel = document.getElementById('stats-panel');
    if(statsPanel){
        statsPanel.innerHTML = `
            <p><strong>Cenas:</strong> ${cenas}</p>
            <p><strong>Personagens:</strong> ${personagens}</p>
            <p><strong>Diálogos:</strong> ${dialogos}</p>
        `;
    }
}
setInterval(atualizarEstatisticas,2000);

/* --- DICIONÁRIO SIMPLES --- */
document.querySelectorAll('#roteiro-tab .script-editor, #rascunho-tab .rascunho-editor').forEach(editor=>{
    editor.addEventListener('input', e=>{
        const palavrasErradas = {'teh':'the','receve':'receive'};
        Object.keys(palavrasErradas).forEach(err=>{
            const regex = new RegExp(`\\b${err}\\b`,'g');
            editor.innerHTML = editor.innerHTML.replace(regex, palavrasErradas[err]);
        });
    });
});

/* --- STORYBOARD --- */
const canvas = document.getElementById('storyboard-canvas');
const ctx = canvas.getContext('2d');
let frames = [
    {x:20,y:20,w:260,h:200, drawing:[]},
    {x:320,y:20,w:260,h:200, drawing:[]},
    {x:620,y:20,w:260,h:200, drawing:[]}
];
let currentFrame = null;
let drawing = false;

function drawFrames(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    frames.forEach(f=>{
        ctx.strokeStyle='#3498db';
        ctx.lineWidth=2;
        ctx.strokeRect(f.x,f.y,f.w,f.h);
        // Desenhos existentes
        ctx.beginPath();
        f.drawing.forEach(line=>{
            ctx.moveTo(line[0].x,line[0].y);
            line.forEach(p=> ctx.lineTo(p.x,p.y));
        });
        ctx.stroke();
    });
}
drawFrames();

canvas.addEventListener('mousedown', e=>{
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX-rect.left;
    const y = e.clientY-rect.top;
    currentFrame = frames.find(f=> x>f.x && x<f.x+f.w && y>f.y && y<f.y+f.h);
    if(currentFrame){
        drawing = true;
        currentFrame.drawing.push([{x:x, y:y}]);
    }
});

canvas.addEventListener('mousemove', e=>{
    if(!drawing || !currentFrame) return;
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX-rect.left;
    const y = e.clientY-rect.top;
    currentFrame.drawing[currentFrame.drawing.length-1].push({x:x,y:y});
    drawFrames();
});

canvas.addEventListener('mouseup', e=>{
    drawing = false;
    currentFrame = null;
});

document.getElementById('add-frame').addEventListener('click', ()=>{
    const last = frames[frames.length-1];
    frames.push({x:last.x+300,y:last.y,w:260,h:200, drawing:[]});
    drawFrames();
});
</script>
</body>
</html>






