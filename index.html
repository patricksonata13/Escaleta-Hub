<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ScriptFlow - Plataforma de Roteiros</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    /* ===== Layout básico ===== */
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
    header, footer { background:#222; color:#fff; text-align:center; padding:10px 0; }
    main { padding:20px; min-height:80vh; }

    /* ===== Botões flutuantes ===== */
    .fab-stack { position:fixed; bottom:20px; right:20px; display:flex; flex-direction:column; gap:10px; z-index:3000; }
    .fab { background:#222; color:#fff; border:none; border-radius:50%; width:50px; height:50px; cursor:pointer; font-size:20px; }
    .fab.secondary { background:#555; }

    /* ===== Painéis flutuantes ===== */
    .float-panel {
      position:fixed; display:flex; flex-direction:column; background:#fff; border:1px solid #ccc; border-radius:8px;
      box-shadow:0 4px 10px rgba(0,0,0,0.2); z-index:2000; width:300px; height:400px; top:100px; right:20px;
      transition: all 0.2s ease;
    }
    .float-header { background:#333; color:#fff; padding:5px 10px; display:flex; justify-content:space-between; align-items:center; cursor:move; border-top-left-radius:8px; border-top-right-radius:8px; }
    .float-title { font-size:14px; display:flex; align-items:center; gap:5px; }
    .float-actions button { background:transparent; border:none; color:#fff; cursor:pointer; margin-left:5px; font-size:14px; }
    .float-body { flex:1; padding:10px; overflow:auto; }
    .minimized { height:40px !important; width:200px !important; overflow:hidden; }

    /* ===== Notificação ===== */
    .notification {
      position:fixed; top:20px; right:20px; background:#333; color:#fff; padding:10px 20px;
      border-radius:5px; opacity:0; transition:opacity 0.3s; z-index:4000;
    }
    .notification.show { opacity:1; }

    /* ===== Inputs e Textarea ===== */
    textarea { font-family: Arial, sans-serif; font-size:14px; padding:5px; border-radius:4px; border:1px solid #ccc; box-sizing:border-box; }
    input { width:100%; padding:5px; border-radius:4px; border:1px solid #ccc; box-sizing:border-box; }
    button { cursor:pointer; }
  </style>
</head>
<body>

  <!-- ===== Header ===== -->
  <header>
    <h1>ScriptFlow - Plataforma de Criação de Roteiros</h1>
  </header>

  <!-- ===== Main ===== -->
  <main>
    <p>Bem-vindo ao ScriptFlow! Utilize os botões flutuantes para acessar chat (Fofoca), vídeo (Chama) e Rascunho.</p>
  </main>

  <!-- ===== Footer ===== -->
  <footer>
    <p>ScriptFlow © 2025 - Plataforma de criação de roteiros</p>
  </footer>

  <!-- ===== Notificação ===== -->
  <div class="notification" id="notification"></div>

  <!-- ===== Botões flutuantes ===== -->
  <div class="fab-stack">
    <button class="fab secondary" id="openChatFab" title="Abrir Fofoca"><i class="fas fa-comments"></i></button>
    <button class="fab" id="openVideoFab" title="Abrir Chama"><i class="fas fa-video"></i></button>
    <button class="fab" id="openRascunhoFab" title="Abrir Rascunho"><i class="fas fa-pencil-alt"></i></button>
  </div>

  <!-- ===== Painel Fofoca ===== -->
  <div class="float-panel" id="chatPanel" style="display:none;">
    <div class="float-header">
      <div class="float-title"><i class="fas fa-comments"></i> Fofoca</div>
      <div class="float-actions">
        <button class="icon-btn" id="chatMinBtn" title="Minimizar"><i class="fas fa-minus"></i></button>
        <button class="icon-btn" id="chatMaxBtn" title="Maximizar"><i class="fas fa-up-right-and-down-left-from-center"></i></button>
        <button class="icon-btn" id="chatCloseBtn" title="Fechar"><i class="fas fa-times"></i></button>
      </div>
    </div>
    <div class="float-body">
      <div class="chat-messages" id="chatMessages"></div>
      <div class="chat-input">
        <input type="text" id="messageInput" placeholder="Digite sua mensagem..." />
        <button id="sendMessageBtn" title="Enviar"><i class="fas fa-paper-plane"></i></button>
      </div>
    </div>
  </div>

  <!-- ===== Painel Chama ===== -->
  <div class="float-panel" id="videoPanel" style="display:none;">
    <div class="float-header">
      <div class="float-title"><i class="fas fa-video"></i> Chama</div>
      <div class="float-actions">
        <button class="icon-btn" id="videoMinBtn" title="Minimizar"><i class="fas fa-minus"></i></button>
        <button class="icon-btn" id="videoMaxBtn" title="Maximizar"><i class="fas fa-up-right-and-down-left-from-center"></i></button>
        <button class="icon-btn" id="videoPopBtn" title="Abrir em janela"><i class="fas fa-window-restore"></i></button>
        <button class="icon-btn" id="videoCloseBtn" title="Fechar"><i class="fas fa-times"></i></button>
      </div>
    </div>
    <div class="float-body">
      <div class="video-box">
        <video id="localVideo" autoplay playsinline muted></video>
        <div class="video-label">Você</div>
      </div>
      <div class="video-controls">
        <button class="video-btn" id="toggleVideoBtn" title="Ligar/Desligar Vídeo"><i class="fas fa-video"></i></button>
        <button class="video-btn" id="toggleAudioBtn" title="Ligar/Desligar Áudio"><i class="fas fa-microphone"></i></button>
        <button class="video-btn" id="screenShareBtn" title="Compartilhar Tela"><i class="fas fa-desktop"></i></button>
        <button class="video-btn" id="recBtn" title="Gravar (WebM)"><i class="fas fa-record-vinyl"></i></button>
        <button class="video-btn end" id="endCallBtn" title="Encerrar"><i class="fas fa-phone-slash"></i></button>
      </div>
    </div>
  </div>

  <!-- ===== Painel Rascunho ===== -->
  <div class="float-panel" id="rascunhoPanel" style="display:none;">
    <div class="float-header">
      <div class="float-title"><i class="fas fa-pencil-alt"></i> Rascunho</div>
      <div class="float-actions">
        <button class="icon-btn" id="rascunhoMinBtn" title="Minimizar"><i class="fas fa-minus"></i></button>
        <button class="icon-btn" id="rascunhoMaxBtn" title="Maximizar"><i class="fas fa-up-right-and-down-left-from-center"></i></button>
        <button class="icon-btn" id="rascunhoCloseBtn" title="Fechar"><i class="fas fa-times"></i></button>
      </div>
    </div>
    <div class="float-body">
      <textarea id="rascunhoTextarea" placeholder="Escreva aqui..." style="width:100%; height:100%; resize:none;"></textarea>
    </div>
  </div>

  <!-- =================== Script unificado =================== -->
  <script>
    // ===== Abrir/Fechar painéis =====
    function togglePanel(id){ 
      const p = document.getElementById(id); 
      p.style.display = p.style.display==='none'?'flex':'none';
    }
    document.getElementById("openChatFab").onclick = ()=>togglePanel('chatPanel');
    document.getElementById("openVideoFab").onclick = ()=>togglePanel('videoPanel');
    document.getElementById("openRascunhoFab").onclick = ()=>togglePanel('rascunhoPanel');

    // ===== Minimizar / Maximizar / Fechar =====
    const chatPanel = document.getElementById("chatPanel");
    document.getElementById("chatMinBtn").onclick = ()=>chatPanel.classList.add("minimized");
    document.getElementById("chatMaxBtn").onclick = ()=>chatPanel.classList.remove("minimized");
    document.getElementById("chatCloseBtn").onclick = ()=>chatPanel.style.display="none";

    const videoPanel = document.getElementById("videoPanel");
    document.getElementById("videoMinBtn").onclick = ()=>videoPanel.classList.add("minimized");
    document.getElementById("videoMaxBtn").onclick = ()=>videoPanel.classList.remove("minimized");
    document.getElementById("videoCloseBtn").onclick = ()=>videoPanel.style.display="none";

    const rascunhoPanel = document.getElementById("rascunhoPanel");
    const rascunhoTextarea = document.getElementById("rascunhoTextarea");
    document.getElementById("rascunhoMinBtn").onclick = ()=>rascunhoPanel.classList.add("minimized");
    document.getElementById("rascunhoMaxBtn").onclick = ()=>rascunhoPanel.classList.remove("minimized");
    document.getElementById("rascunhoCloseBtn").onclick = ()=>rascunhoPanel.style.display="none";

    // ===== Persistência Rascunho =====
    const STORAGE_RASCUNHO="rascunho_text";
    if(localStorage.getItem(STORAGE_RASCUNHO)) rascunhoTextarea.value = localStorage.getItem(STORAGE_RASCUNHO);
    rascunhoTextarea.addEventListener("input",()=>localStorage.setItem(STORAGE_RASCUNHO, rascunhoTextarea.value));

    // ===== Tornar painéis arrastáveis =====
    function makeDraggable(panelId){
      const panel = document.getElementById(panelId);
      const header = panel.querySelector('.float-header');
      let offsetX=0, offsetY=0, isDown=false;

      header.addEventListener('mousedown',(e)=>{
        isDown=true;
        offsetX = panel.offsetLeft - e.clientX;
        offsetY = panel.offsetTop - e.clientY;
      });

      document.addEventListener('mouseup',()=>isDown=false);
      document.addEventListener('mousemove',(e)=>{
        if(!isDown) return;
        panel.style.top=(e.clientY+offsetY)+'px';
        panel.style.left=(e.clientX+offsetX)+'px';
      });
    }
    makeDraggable('chatPanel');
    makeDraggable('videoPanel');
    makeDraggable('rascunhoPanel');

    // ===== Estado global / Persistência =====
    const STORAGE_KEY = 'scriptflow_data_v2';
    const state = {
      argument:{storyline:'',logline:'',synopsis:'',argument:''},
      outline:'', script:'', treatment:'', bible:'',
      storyboard:[], messages:[],
      writersroom:{ integrantes:[], agenda:[], tasks:[], scratch:'' },
      ui:{ chatOpen:false, videoOpen:false, chatMin:false, videoMin:false, chatMax:false, videoMax:false }
    };

    function loadState(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      try{
        const saved = JSON.parse(raw);
        Object.assign(state, saved);
      }catch(e){console.warn('Falha ao carregar estado:', e)}
    }

    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function notify(msg){
      const n = document.getElementById('notification');
      if(!n) return;
      n.textContent = msg;
      n.classList.add('show');
      setTimeout(()=>n.classList.remove('show'), 2500);
    }
  </script>

</body>
</html>


